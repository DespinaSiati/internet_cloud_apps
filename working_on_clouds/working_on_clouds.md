% Διαδικτυακές και Νεφοϋπολογιστικές Εφαρμογές
% Αν. Καθηγητής Π. Λουρίδας
% Οικονομικό Πανεπιστήμιο Αθηνών

# Δουλεύοντας στα Σύννεφα

## Βοήθεια, τι είναι αυτά τα πράγματα;

* Οποιοσδήποτε θέλει να δουλέψει στον χώρο της πληροφορικής πρέπει να
  ξέρει το λειτουργικό σύστημα Linux.
  
* Αν δεν έχετε σχετικές γνώσεις, καλό είναι να τις αποκτήσετε τώρα.

* Υπάρχουν πολλές πηγές στο διαδίκτυο. Μια καλή επιλογή είναι το
  βιβλίο [The Linux Command Line](http://linuxcommand.org/tlcl.php) το
  οποίο διατίθεται δωρεάν σε μορφή PDF.
  
* Φιλική συμβουλή: διαβάστε τουλάχιστον το πρώτο μέρος για να
  αποκτήσετε μια σχετική ευχέρεια.

# Δημιουργία Ιδεατής Μηχανής στον Ωκεανό

## Δημιουργία Ιδεατής Μηχανής στον Ωκεανό (1)

* Αφού εισέλθουμε στον [~okeanos](https://okeanos.grnet.gr) προχωράμε
  στο dashboard.

* Στο okeanos dashboard επιλέγουμε Projects.

* Στο projects επιλέγουμε join a project.
  
* Βρίσκουμε το icc.dmst.aueb.gr και επιλέγουμε το join.

* Υποβάλουμε αίτηση για τη συμμετοχή μας σε αυτό και ενημερώνουμε το
  διδάσκοντα. 

## Δημιουργία Ιδεατής Μηχανής στον Ωκεανό (2)

* Προχωράμε στη δημιουργία νέας ιδεατής μηχανής (New Machine +).

* Επιλέγουμε ως μήτρα (image) την πιο πρόσφατη έκδοση Ubuntu Server.

## Δημιουργία Ιδεατής Μηχανής στον Ωκεανό (3)

* Επιλέγουμε το project icc.dmst.aueb.gr (αφού έχει εγκριθεί η
  συμμετοχή μας).

* Επιλέγουμε π.χ. 1 CPU, 4 GB μνήμης RAM, 40 GB δίσκο.

* Στη συνέχεια, αν θέλουμε να της δώσουμε και διεύθυνση IPv4, θα
  πρέπει στην επόμενη οθόνη να δημιουργήσουμε μια νέα (create new).

* Όταν αυτή δημιουργηθεί, τσεκάρουμε τη διεύθυνση αυτή στην επιλογή
  Internet (public IPv4).

## Δημιουργία Ιδεατής Μηχανής στον Ωκεανό (4)

* Στην επόμενη οθόνη, δίνουμε ένα περιγραφικό όνομα στη μηχανή μας.

* Επιβεβαιώνουμε τις συνολικές επιλογές μας και δίνουμε create
  machine. 

## Δημιουργία Ιδεατής Μηχανής στον Ωκεανό (5)

* Όταν δημιουργηθεί η ιδεατή μηχανή, θα μας εμφανιστεί στην οθόνη
  ένας κωδικός, τον οποίον πρέπει να αντιγράψουμε.

* Αν δεν εμφανιστεί τέτοιο μήνυμα, αλλά ένα μήνυμα που μας ενημερώνει
  ότι η διαδικασία καθυστερεί για κάποιο λόγο:
    * δίνουμε Reload, και περιμένουμε να ολοκληρωθεί η διαδικασία.
    * όταν ολοκληρωθεί, πατάμε πάνω στο εικονίδιο της μηχανής, όπου
      θα δούμε πάλι τον κωδικό μας.

* Τότε, θα εμφανιστεί μήνυμα με το όνομα χρήστη και τον τρόπο
  σύνδεσης, όπως:

    ```bash
	ssh user@snf-842276.vm.okeanos.grnet.gr
    ```

## Ενημέρωση Ιδεατής Μηχανής στον Ωκεανό (1)

* Πρέπει να εγκαταστήσουμε στην ιδεατή μηχανή μας τις νεώτερες
  εκδόσεις των πακέτων του λειτουργικού.

* Μπαίνουμε στη μηχανή μας με (η δική σας μηχανή θα έχει άλλα
  στοιχεία):
  
    ```bash
	ssh user@snf-842276.vm.okeanos.grnet.gr
    ```

## Ενημέρωση Ιδεατής Μηχανής στον Ωκεανό (2)

* Στη συνέχεια δίνουμε:

    ```bash
    sudo apt-get update
    sudo apt-get upgrade
    ```

* Όταν μας ζητηθεί, δίνουμε τον κωδικό εισόδου μας.

* Στο τέλος της διαδικασίας καλό είναι να βγούμε και να ξαναμπούμε στο
  σύστημα.
  
* Αν μπαίνοντας στο σύστημα δούμε μήνυμα:
  ```
  *** System restart required ***
  ```
  τότε δίνουμε:
  ```bash
  sudo reboot now
  ```
    
## Ενημέρωση Ιδεατής Μηχανής στον Ωκεανό (3)

* Αν παίρνουμε πάλι μηνύματα που μας λένε ότι υπάρχουν ενημερώσεις,
  ακόμα και αμέσως μετά τα παραπάνω, τότε δίνουμε:
  
    ```bash
    sudo apt-get dist-upgrade
    ```
    
* Στο τέλος ξεκινάμε πάλι το σύστημα.

## Ενημέρωση Ιδεατής Μηχανής στον Ωκεανό (4)

* Μπορεί όταν ξαναμπούμε στο σύστημα να εμφανιστεί ένα μήνυμα το οποίο
  μας ενημερώνει ότι υπάρχει νέα έκδοση διαθέσιμη, με οδηγίες πώς να
  προχωρήσουμε στην ενημέρωση:

	```bash
	New release '18.04.1 LTS' available.
    Run 'do-release-upgrade' to upgrade to it.
	```

* Για να κάνουμε την ενημέρωση, ακολουθούμε τις οδηγίες.


## Εκκαθάριση Παλαιών Πυρήνων (1)

* Κάθε φορά που κάνουμε `dist-upgrade` ή `do-release-upgrade`
  εγκαθιστούμε νέο πυρήνα στο λειτουργικό σύστημα.
  
* Οι προηγούμενοι πυρήνες δεν διαγράφονται, αλλά παραμένουν στον
  κατάλογο `/boot`.

* Μετά από κάποιον καιρό μπορεί να τρώνε πολύ χώρο. Τότε μπορούμε να
  αποφασίσουμε να τους σβήσουμε.


## Εκκαθάριση Παλαιών Πυρήνων (2)

<https://gist.github.com/ipbastola/2760cfc28be62a5ee10036851c654600>
  
1. Ελέγχουμε την έκδοση του τρέχοντα πυρήνα:

    ```bash
	uname -r
	```
	οπότε μπορεί να δούμε κάτι του τύπου:
	
	```
	4.15.0-36-generic
	```
	
2. Για να δούμε τους παλιούς πυρήνες δίνουμε:

	```bash
	sudo dpkg --list 'linux-image*' | awk '{ if ($1=="ii") print $2}' | grep -v `uname -r`
    ```
	οπότε θα πάρουμε μια λίστα όπως:
	
	```
	linux-image-4.4.0-137-generic
	linux-image-extra-4.4.0-137-generic
	linux-image-generic
	```
	
## Εκκαθάριση Παλαιών Πυρήνων (3)

3. Σβήνουμε έναν-έναν τους παλιούς πυρήνες:

    ```bash
    sudo apt-get purge linux-image-4.4.0-137-generic
    sudo apt-get purge linux-image-extra-4.4.0-137-generic
    sudo apt-get purge linux-image-generic
    ```

4. Καθαρίζουμε και τυχόν άλλα πακέτα με:

    ```bash
	sudo apt-get autoremove
	```
	
5. Ενημερώνουμε τη λίστα των πυρήνων που εμφανίζει το grub (όταν
   πατάμε Shift καθώς τρέχει στην εκκίνηση):
   
    ```bash
	sudo update-grub
	```

# Εγκατάσταση Δημοσίου Κλειδιού

## Ετοιμάζοντας το Έδαφος σε MS-Windows (1)

* Σε περίπτωση που χρησιμοποιείτε λειτουργικό σύστημα Mac OS ή Linux,
  έχετε ήδη τα απαραίτητα εργαλεία για κρυπτογραφία δημοσίου κλειδιού
  στον υπολογιστή σας.
  
* Σε περίπτωση που χρησιμοποιείτε MS-Windows, ένας εύκολος τρόπος να
  τα αποκτήσετε είναι να εγκαταστήσετε το [Git for
  Windows](https://gitforwindows.org/).
  
* Όταν το εγκαταστήσουμε θα δούμε ότι θα είναι διαθέσιμο το git BASH,
  ένα τερματικό από το οποίο έχουμε πρόσβαση σε αρκετά εργαλεία του
  Linux. 
  
## Ετοιμάζοντας το Έδαφος σε MS-Windows (2)

* Εναλλακτικά, μπορούμε να εγκαταστήσουμε την εργαλειοθήκη
  [Cygwin](https://www.cygwin.com/).
  
* Αφού την εγκαταστήσετε, ξεκινήστε το πρόγραμμα Cygwin και στη
  συνέχεια μέσα από αυτό μπορείτε να εγκαταστήσετε τα πακέτα SSH.
  
* Στη συνέχεια θεωρούμε ότι έχουμε στη διάθεσή μας ένα τερματικό bash
  (μας το δίνει το Cygwin).
  
## Ετοιμάζοντας το Έδαφος σε MS-Windows (3)
  
* Το τερματικό πρόγραμμα των MS-Windows (cmd.exe) είναι απλώς
  απαράδεκτο.
  
* Καλύτερα να χρησιμοποιήσετε κάποιο εναλλακτικό, όπως το
  [ConEmu](https://conemu.github.io/).


## Δημιουργία Κλειδιού RSA

* Θα ξεκινήσουμε δημιουργώντας ένα νέο κλειδί RSA.

    ```
    ssh-keygen -b 4096 -t rsa
    Generating public/private rsa key pair.
    ```

## Αποθήκευση κλειδιού

* Το πρόγραμμα θα μας ζητήσει το όνομα και τη θέση όπου θα αποθηκευτεί
  το ζεύγος κλειδιών.

    ```
    Enter file in which to save the key (/Users/panos/.ssh/id_rsa): /Users/panos/.ssh/id_rsa_icc
    ```

## Κωδικός Κλειδιού

* Αν θέλουμε μπορούμε να δώσουμε ένα κλειδί το οποίο θα μας ζητείται
  όταν το χρησιμοποιούμε. Μπορείτε να το αφήσετε κενό.

    ```
    Enter passphrase (empty for no passphrase):
    Enter same passphrase again:
    ```

## Αποθήκευση Κλειδιού

* Τότε θα αποθηκευτεί το κλειδί μας στην τοποθεσία που δώσαμε και θα
  δούμε κάτι όπως το παρακάτω:

    ```
    Your identification has been saved in /Users/panos/.ssh/id_rsa_icc.
    Your public key has been saved in /Users/panos/.ssh/id_rsa_icc.pub
    The key fingerprint is:
	SHA256:alFxk9OAErbR0EkP/iwGqtSccVL7tTMtxA+2gobed/4 panos@Panos-MBP.lan
	The key's randomart image is:
	+---[RSA 4096]----+
	|      **+o++     |
	|     o.==*o..    |
	|    o =.o B.     |
	|   o B = * *     |
	|  . * + S O o    |
	| . o o + o +     |
	|  . . + . .      |
	|     . . o       |
	|          ..E    |
	+----[SHA256]-----+	
    ```
	
<div class="notes">

Το αποτέλεσμα της εντολής μας δείχνει πού αποθηκεύονται το ιδιωτικό
και το δημόσιο κλειδί. Επίσης μας δίνει το ψηφιακό αποτύπωμα του
δημόσιου κλειδιού. Ο τρόπος με τον οποίο παράγεται το αποτύπωμα
φαίνεται με το παρακάτω πρόγραμμα:

```python
import sys
import base64
import hashlib

b64pubkey = open(sys.argv[1]).read().split(' ')[1]
sha256 = hashlib.sha256()
sha256.update(base64.b64decode(b64pubkey))
hash_sha256 = sha256.digest()
print(base64.b64encode(hash_sha256))
```

Αν καλέσετε το πρόγραμμα αυτό με παράμετρο το δημόσιο κλειδί, θα σας
εμφανίσει:
```
b'alFxk9OAErbR0EkP/iwGqtSccVL7tTMtxA+2gobed/4='
```

Στην ουσία, παίρνει το δημόσιο κλειδί, το οποίο είναι κωδικοποιημένο
σε μορφή [Base64](https://en.wikipedia.org/wiki/Base64). 

Μπορεί να αναρωτιέστε τι είναι αυτό το "randomart image" που
εμφανίστηκε. Κάθε κλειδί έχει ένα ψηφιακό αποτύπωμα, με βάση το οποίο
μπορούμε να το αναγνωρίζουμε. Έτσι, όταν συνδεόμαστε σε έναν
εξυπηρετητή, μπορούμε να ελέγχουμε το ψηφιακό του αποτύπωμα,
προκειμένου να διαπιστώσουμε ότι είναι πράγματι αυτό που περιμένουμε.

Το πρόβλημα είναι ότι δεν είναι εύκολο να θυμόμαστε ποιο είναι αυτό το
ψηφιακό αποτύπωμα (παραπάνω, στο δικό μας κλειδί, είναι αυτό που
ακολουθεί το `SHA256:`). Το randomart image είναι ένα ψηφιακό αποτύπωμα
που μπορούμε εύκολα να το αναγνωρίζουμε οπτικά.

Αν στο αρχείο `~/.ssh/config` του υπολογιστή μας (βλ. παρακάτω),
δώσουμε την παράμετρο `VisualHostKey=yes` στις ρυθμίσεις για τον
συγκεκριμένο εξυπηρετητή, τότε κάθε φορά που μπαίνουμε σε αυτόν θα μας
εμφανίζει το randomart image του κλειδιού του. Αν λοιπόν κάποια στιγμή
δούμε ένα διαφορετικό, ξέρουμε ότι κάτι πολύ καλό συμβαίνει.

*Προσοχή*: όταν συνδεόμαστε στον εξυπηρετητή βλέπουμε το randomart του
κλειδιού *του*, όχι του κλειδιού μας. Τότε, μπορεί να αναρωτηθείτε,
για ποιο λόγο εμφανίζεται το randomart του κλειδιού μας, όταν αυτό
δημιουργείται, αφού δεν το ξαναβλέπουμε; Γιατί η δημιουργία του
κλειδιού είναι ανεξάρτητη από τη χρήση του. Μπορούμε κάλλιστα να
δημιουργήσουμε ένα κλειδί και αντί για προσωπική χρήση να το
χρησιμοποιήσουμε ως κλειδί του εξυπηρετητή μας.

Όπως εμείς δημιουργήσαμε ένα δικό μας ζευγάρι κλειδιών, έτσι έχει
δημιουργήσει αυτομάτως και ο εξυπηρετητής στον οποίο θέλουμε να
συνδεθούμε ένα δικό του. Το δικό μας ζευγάρι κλειδιών ταυτοποιεί εμάς.
Το ζευγάρι του εξυπηρετητεί ταυτοποιεί τον εξυπηρετητή. Άρα για να
είμαστε σίγουροι ότι όλα πάνε καλά θα μπορούσαμε να ελέγχουμε κάθε
φορά που συνδεόμαστε με τον εξυπηρετητή ότι ο εξυπηρετητής εξακολουθεί
να έχει το σωστό κλειδί. 

Θυμηθείτε ότι στη μέθοδο κρυπτογράφησης RSA και οι δύο συνομιλητές
έχουν ζευγάρια κλειδιών, ένα ο καθένας. Εδώ λοιπόν μας ενδιαφέρει να
μπορούμε να διαπιστώσουμε με μια ματιά ότι το κλειδί του εξυπηρετητή
είναι αυτό που περιμένουμε.

Αν από περιέργεια θέλουμε να δούμε το κλειδί που χρησιμοποιεί ο
εξυπηρετητής, μπορούμε να βρούμε την τοποθεσία του κοιτάζοντας τον
κατάλογο `/etc/ssh/`. Συνήθως το ιδιωτικό RSA κλειδί του εξυπηρετητή
είναι το `/etc/ssh/ssh_host_rsa_key` και το δημόσιο RSA κλειδί του
εξυπηρετητή είναι το `/etc/ssh/ssh_host_rsa_key.pub`.

Το δημόσιο κλειδί είναι αποθηκευμένο στο αρχείο του σε συγκεκριμένη
μορφοποίηση η οποία περιγράφεται στο [RFC
4253](https://tools.ietf.org/html/rfc4253#section-6.6), ενώ το
ιδιωτικό κλειδί είναι αποθηκευμένοι στο αρχείο του σε μορφοποίηση που
περιγράφεται στο [RFC 8017](https://tools.ietf.org/html/rfc8017). Το
πρότυπο αυτό ονομάζεται [PKCS
#1](https://en.wikipedia.org/wiki/PKCS_1) (PKCS σημαίνει Public-Key
Cryptography Standards) και έχει δημιουργηθεί από την εταιρεία RSA
(των δημιουργών του κρυπτοσυστήματος RSA). 

Αν θέλουμε να δούμε τι ακριβώς αποθηκεύεται σε αυτά τα αρχεία, αρκεί
να δώσουμε:
```bash
openssl rsa -text -noout -in ~/.ssh/id_rsa_icc
```
οπότε στην οθόνη μας θα εμφανιστούν οι ακόλουθες πληροφορίες:

* μήκος κλειδιού σε bits
* modulus
* publicExponent
* privateExponent
* prime1
* prime2
* exponent1
* exponent2

Οι αριθμοί θα εμφανιστούν κωδικοποιημένοι στο δεκαεξαδικό σύστημα
αρίθμησης, όπου κάθε byte αναπαρίσταται με δύο χαρακτήρες· τα bytes
χωρίζονται μεταξύ τους, για λόγους εμφάνισης, με τον χαρακτήρα :.

Τι είναι τα παραπάνω; Θυμηθείτε ότι το σύστημα RSA λειτουργεί με βάση
τα εξής:

* Δύο πρώτους αριθμούς $p$ κα $q$: αυτοί είναι οι prime1 και prime2.
* Το γινόμενό τους $n = pq$: αυτό είναι το modulus.
* Το δημόσιο κλειδί είναι το $(e, n)$, όπου $e$ είναι το
  publicExponent.
* Το ιδιωτικό κλειδί είναι το $(d, n)$, όπου $d$ είναι το
  privateExponent. 
* Το exponent1 είναι ίσο με $d\ \textrm{mod} (p - 1)$ και το exponent2
  είναι ίσο με $d\ \textrm{mod} (q - 1)$· αυτά χρησιμοποιούνται για πιο
  αποτελεσματικούς υπολογισμούς, βλ. [τη χρήση του Κινέζικου
  Θεωρήματος στο
  RSA](https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Using_the_Chinese_remainder_algorithm).

</div>

## Εγκατάσταση του Δημόσιου Κλειδιού (1)

* Αντιγράφουμε το κλειδί στην ιδεατή μηχανή μας ως εξής (αντικαθιστάτε
τα δικά σας στοιχεία):

    ```bash
    scp /Users/panos/.ssh/id_rsa_icc.pub user@snf-842276.vm.okeanos.grnet.gr:
    ```

## Εγκατάσταση του Δημόσιου Κλειδιού (2)

* Στη συνέχεια μπαίνουμε πάλι στην ιδεατή μας μηχανή και δίνουμε:

    ```bash
    mkdir .ssh
    mv id_rsa_icc.pub ~/.ssh/authorized_keys
    chmod 700 .ssh
    chmod 400 .ssh/authorized_keys
    ```
    
* Βγαίνουμε από την ιδεατή μηχανή μας και ελέγχουμε ότι μπορούμε να
  συνδεθούμε χωρίς να δώσουμε κωδικό:
  
    ```bash
    ssh -i /Users/panos/.ssh/id_rsa_icc user@snf-842276.vm.okeanos.grnet.gr
    ```

## Εγκατάσταση του Δημόσιου Κλειδιού (3)

* Για να συνδεόμαστε πιο εύκολα, φτιάχνουμε ένα αρχείο `config` στον
  κατάλογο `.ssh` του υπολογιστή μας (ή το ανοίγουμε αν ήδη υπάρχει)
  και γράφουμε:

    ```
    Host icc
    Hostname snf-842276.vm.okeanos.grnet.gr
    User user
    VisualHostKey=yes
    IdentityFile ~/.ssh/id_rsa_icc
    ```

* Στη συνέχεια θα μπορούμε να μπούμε κατ' ευθείαν στην ιδεατή μηχανή
  μας δίνοντας:

    ```bash
    ssh icc
    ```

<div class="notes">

Προσέξτε ότι αν τώρα μπούμε στο μηχάνημά μας, θα δούμε το randomart,
οπότε εμφανίζεται κάτι όπως:

```
Host key fingerprint is SHA256:GEwvoAIRTJOptJbt47XB8Uc61VAgxl/lCj0j9wyvjQA
+---[ECDSA 256]---+
|*=o . oo .o...   |
|.=.. +.o.....    |
|+ =   +Eoo+* .   |
|.= . . +.++.O    |
|. . . + S. . +   |
|   o + + .. +    |
|  . o o o  o .   |
|   . .           |
|                 |
+----[SHA256]-----+
```

Η επικεφαλλίδα στο randomart είναι διαφορετική από αυτή που είδαμε
προηγουμένως: ενώ πριν έλεγε `[RSA 4096]`, τώρα λέει `[ECDSA 256]`.
Αυτό συμβαίνει γιατί το κλειδί του εξυπηρετητή (που δημιουργήθηκε
αυτόματα όταν κατασκευάστηκε), δεν είναι τύπου RSA, αλλά τύπου ECDSA. 

Όπως μπορούμε να διαπιστώσουμε π.χ. με:

```bash
sudo ls /etc/ssh/
```

ο εξυπηρετητής έχει διάφορα κλειδιά (DSA, ECDSA, ED25519, RSA). Αυτά
αντιστοιχούν σε διαφορετικούς κρυπτογραφικούς αλγόριθμους. Τα κλειδιά
τύπου ECDSA χρησιμοποιούν [κρυπτογραφία ελλειπτικών καμπύλων (elliptic
curve cryptography,
ECC)](https://en.wikipedia.org/wiki/Elliptic-curve_cryptography). Αυτή
είναι πιο πρόσφατη μέθοδος κρυπτογραφίας, η οποία μας δίνει την ίδια
ασφάλεια με παλαιότερες μεθόδους όπως η RSA, αλλά με μικρότερα
κλειδιά. Για παράδειγμα, ένα κλειδί RSA μήκους 4096 bits συγκρίνεται,
ως προς την ασφάλεια με ένα κλειδί ECDSA μήκους 383 bits. Μικρότερα
κλειδιά αντιστοιχούν σε μεγαλύτερη ταχύτητα, όπως μπορούμε να δούμε αν
δώσουμε:

```bash
openssl speed ecdsap256 rsa4096
```

οπότε θα πάρουμε κάτι όπως:
```
                  sign    verify    sign/s verify/s
rsa 4096 bits 0.017257s 0.000256s     57.9   3906.1
                              sign    verify    sign/s verify/s
 256 bit ecdsa (nistp256)   0.0002s   0.0002s   5671.8   4180.1
```

Παρατηρούμε ότι σημαντική διαφορά υπάρχει στην υπογραφή, όχι τόσο στην
επιβεβαίωση της υπογραφής.

Τα κλειδιά ECDSA μπορούν να χρησιμοποιηθούν μόνο για υπογραφές, ενώ τα
κλειδιά RSA και για υπογραφές και για κρυπτογράφηση.

</div>


## Ρύθμιση `sudo`

* Αυτή τη στιγμή κάθε φορά που τρέχουμε την εντολή `sudo` στην ιδεατή
  μηχανή μας, χρειάζεται να δώσουμε τον κωδικό μας.

* Για να μην χρειάζεται αυτό, αφού μπούμε στη μηχανή μας δίνουμε:

    ```bash
    sudo visudo
    ```
* Στη συνέχεια αλλάζουμε τη γραμμή:
  ```
  %sudo   ALL=(ALL:ALL) ALL
  ```
  σε
  ```
  %sudo   ALL=(ALL:ALL) NOPASSWD:ALL
  ```

# Ενημέρωση συστήματος

## Διαδικασία ενημέρωσης

* Πρέπει σε τακτά χρονικά διαστήματα να ενημερώνουμε τα συστήματά μας
  με τις νεώτερες εκδόσεις του λογισμικού που χρησιμοποιούμε. 
  
* Βλέπουμε ότι χρειάζεται να το κάνουμε αυτό όταν μπαίνοντας στο
  σύστημα μας εμφανίσει αντίστοιχο μήνυμα.
  
* Αφού μπούμε στο σύστημά μας δίνουμε τις εντολές:

    ```bash
    sudo apt-get update
    sudo apt-get upgrade
    ```
    
* Στη συνέχεια βγαίνουμε και ξαναμπαίνουμε στο σύστημά μας. Αν λάβουμε
  πάλι μήνυμα ότι χρειάζονται ενημερώσεις, τότε δίνουμε:
  
    ```bash
    sudo apt-get dist-upgrade
    ```
    
<div class="notes">

Στην περίπτωση που κάνουμε `dist-upgrade` μπορεί να ανανεωθεί και ο
πυρήνας (kernel) του λογισμικού. Στην περίπτωση αυτή καλό είναι να
επανεκκινήσουμε το σύστημά μας με:

```bash
sudo shutdown -r now
```

Σε κάθε περίπτωση όταν απαιτείται επανεκκίνηση μας εμφανίζεται
κατάλληλο μήνυμα (```*** System restart required ***```) όταν
μπαίνουμε στο σύστημα.

</div>


# Δημιουργία Ιδεατής Μηχανής σε AWS

## Δημιουργία Ιδεατής Μηχανής σε AWS (1)

* Αν δεν έχουμε, δημιουργούμε λογαριασμό στο AWS.

* Ακολουθούμε τις οδηγίες στο PDF που έχει αναρτηθεί στην ιστοσελίδα
  του μαθήματος προκειμένου να ενεργοποιήσουμε τη δωρεάν πίστωση που
  έχουμε.

## Δημιουργία Ιδεατής Μηχανής σε AWS (2)

* Επιλέγουμε Services.

* Επιλέγουμε από τα Compute το EC2.

## Δημιουργία Ιδεατής Μηχανής σε AWS (3)

* Επιλέγουμε Launch Instance.

* Στη συνέχεια θα δούμε ένα πλήθος Amazon Machine Images (AMIs). 

* Το βολικότερο ίσως είναι να επιλέξετε το Ubuntu Server.

## Δημιουργία Ιδεατής Μηχανής σε AWS (4)

* Υπάρχουν διάφοροι τύποι ιδεατής μηχανής, αναλόγως με τους
  υπολογιστικούς πόρους.
  
* Η ιδεατή μηχανή t2.micro δίνεται δωρεάν (με κάποια συγκεκριμένα
  όρια), βλ. [free tier](https://aws.amazon.com/free/).
  
* Στην ουσία μπορείτε να τη χρησιμοποιείτε 750 ώρες το μήνα χωρίς
  χρέωση, δηλαδή όλο το μήνα.
  
* Αν θέλετε να χρησιμοποιήσετε κάτι άλλο, τότε αρχίζει η χρέωση (ή η
  κατανάλωση της πίστωσης που έχετε).
  
## Δημιουργία Ιδεατής Μηχανής σε AWS (5)

* Στις ρυθμίσεις της ιδεατής μηχανής, συνήθως δεν χρειάζεται να
  αλλάξετε κάτι (εκτός αν είστε πεπειραμένος χρήστης).
  
* Για παράδειγμα, μπορείτε να ορίσετε Virtual Private Clouds (VPCs),
  δηλαδή ένα δικό σας απομονωμένο υποσύνολο του AWS με τις δικές σας
  διευθύνσεις κ.λπ.
  
## Δημιουργία Ιδεατής Μηχανής σε AWS (6)

* Η ιδεατή μηχανή t2.micro έχει κατ' αρχήν 8 GB μνήμης.

* Μπορείτε να τα αυξήσετε μέχρι τα 30 στο πλαίσιο του free teer.

* Ή μπορείτε να το αυξήσετε όσο θέλετε και να αρχίσετε να καταλανώνετε
  χρήματα ή πίστωση.
  
* Ο χώρος μπορεί να είναι είτε στο δίσκο root (root volume), είτε σε
  άλλο δίσκο που μπορείτε να δημιουργήσετε και να προσαρτήσετε στην
  ιδεατή σας μηχανή.
  
## Δημιουργία Ιδεατής Μηχανής σε AWS (7)

* Σε κάθε ιδεατή μηχανή και δίσκο μπορείτε να ορίσετε ετικέτες (tags).

* Οι ετικέτες είναι ζεύγη κλειδιών τιμών, που μπορούν να μας βοηθούν
  να κατηγοροποιήσουμε τους πόρους μας.
  
  
## Δημιουργία Ιδεατής Μηχανής σε AWS (8)

* Αρχικά, η ιδεατή μηχανή δέχεται συνδέσεις μόνο μέσω SSH (θύρα 22).

* Αν θέλουμε να δέχεται συνδέσεις και μέσω HTTP (θύρα 80), HTTPS (θύρα
  443), κ.λπ., θα πρέπει να προσθέσουμε τους αντίστοιχους κανόνες.

## Δημιουργία Ιδεατής Μηχανής σε AWS (9)

* Η πρόσβαση στην ιδεατή μηχανή γίνεται μόνο μέσω ζεύγους ιδιωτικού /
  δημοσίου κλειδιού.
  
* Επιλέγουμε λοιπόν τη δημιουργία νέου κλειδιού (εκτός αν έχουμε ήδη
  κάποιο και θέλουμε να το επαναχρησιμοποιήσουμε).
  
## Σύνδεση στην Ιδεατή Μηχανή

<https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html>

* Αποθηκεύμουμε το αρχείο `.pem` στον κατάλογο `~/.ssh`

* Εξασφαλίζουμε ότι μόνο εμείς μπορούμε να το διαβάσουμε:

   ```bash
   chmod 400 /Users/panos/.ssh/icc_amazon_key_pair.pem
   ```
   
* Συνδεόμαστε μέσω SSH

    ```bash
    ssh -i /Users/panos/.ssh/icc_amazon_key_pair.pem ubuntu@ec2-34-254-205-134.eu-west-1.compute.amazonaws.com
    ```
