% Διαδικτυακές και Νεφοϋπολογιστικές Εφαρμογές
% Αν. Καθηγητής Π. Λουρίδας
% Οικονομικό Πανεπιστήμιο Αθηνών

# Σχεδιασμός Σχεσιακών Βάσεων

## Βασικές αρχές

* Στις σχεσιακές βάσεις τα δεδομένα μας απεικονίζονται με τη μορφή
  *σχέσεων* (relations).

* Μια σχέση έχει μαθηματικό ορισμό· με βάση τον ορισμό αυτό συνήθως
  σκεφτόμαστε τις σχέσεις ως πίνακες.

* Το πρόβλημα λοιπόν που έχουμε όταν θέλουμε να σχεδιάσουμε μια
  σχεσιακή βάση δεδομένων είναι να βρούμε τους πίνακες με τους οποίους
  μπορούμε να απεικονίσουμε τα δεδομένα μας.

## Σχέσεις

* Μια σχέση $R$ είναι ένα σύνολο από πλειάδες $(d_1, d_2, \ldots, d_n)$,
  όπου κάθε $d_i \in D_i$, με $D_i$ ένα συγκεκριμένο *πεδίο τιμών*
  (data domain).
  
* Συνήθως γράφουμε $R(D_1, D_2, \ldots, D_n)$.
  
* Έτσι, μια σχέση αντιστοιχεί σε έναν πίνακα, όπου οι στήλες έχουν τις
  τιμές των $d_i$.
  
* Η σειρά των στηλών στον πίνακα, όπως και η σειρά των $d_i$, δεν έχει
  κάποια σημασία.

* Τα $d_i$ ονομάζονται *ιδιότητες* (attributes) της σχέσης. 


## Συναρτησιακές εξαρτήσεις (1)

* Μια *συναρτησιακή εξάρτηση* (functional dependency, FD) σε μία σχέση $R$
  είναι ένας περιορισμός μεταξύ δύο συνόλων ιδιοτήτων σε μία σχέση. 
  
* Συγκεκριμένα, λέμε ότι οι ιδιότητες $Α_1, Α_2, \ldots, $A_n$
  προσδιορίζουν συναρτησιακά την ιδιότητα $Β$, αν όταν δύο πλειάδες
  της σχέσης $R$ έχουν τις ίδιες τιμές στις ιδιότητες $Α_1, Α_2,
  \ldots, Α_n$, τότε θα έχουν την ίδια τιμή και σε μία άλλη ιδιότητα
  $Β$.
  
* Αυτό γράφεται ως:
  $$A_1, A_2, \ldots, A_n \rightarrow B$$
  και ονομάζουμε τη συνθήκη αυτή συναρτησιακή εξάρτηση.


## Συναρτησιακές εξαρτήσεις (2)

* Αν ένα σύνολο ιδιοτήτων $A_1, A_2, \ldots, A_n$ προσδιορίζει
  περισσότερες από μία ιδιότητα, για παράδειγμα:
  
  $$A_1, A_2, \ldots, A_n \rightarrow B_1$$
  $$A_1, A_2, \ldots, A_n \rightarrow B_2$$
  $$ \cdots $$
  $$A_1, A_2, \ldots, A_n \rightarrow B_m$$
  τότε μπορούμε να γράψουμε για συντομία:
  
  $$A_1, A_2, \ldots, A_n \rightarrow B_{1}Β_{2}\ldots B_{m}$$
  
  
## Συναρτησιακές εξαρτήσεις (3)

* Μια συναρτησιακή εξάρτηση $A_1 A_2 \ldots A_n \rightarrow B$ ονομάζεται
  *τετριμμένη* (trivial) αν η $B$ είναι μία από τις $A_i$.

* Μια συναρτησιακή εξάρτηση $A_1 A_2 \ldots A_n \rightarrow B_1 B_2
  \ldots B_m$ ονομάζεται:
  * *τετριμμένη* (trivial) αν οι $B_j$ είναι υποσύνολο των $A_i$.
  * *μη τετριμμένη* (nontrivial) αν τουλάχιστον μία από τις $B_j$
    δεν υπάρχει στις $A_i$.
  * *πλήρως μη τετριμμένη* (completely nontrivial) αν καμμία από τις
    $B_j$ δεν υπάρχει στις $A_i$.
  

## Μεταβατικότητα συναρτησιακών εξαρτήσεων

* Αν 
  $$A_1 A_2 \ldots A_n \rightarrow B_1 B_2 B_m$$
  και 
  $$B_1 B_2 \ldots B_m \rightarrow C_1 C_2 C_k$$
  τότε έχουμε επίσης:
  $$A_1 A_2 \ldots A_n \rightarrow C_1 C_2 C_k$$
  
* Στην περίπτωση που έχουμε $X \rightarrow Y \rightarrow Z$, λέμε ότι
  η συναρτησιακή εξάρτηση $X \rightarrow Z$ είναι *μεταβατική*
      (transitive) ή έμμεση (indirect).
  
* Αν έχουμε $X \rightarrow Y$ χωρίς ενδιάμεση συναρτησιακή εξάρτηση,
  λέμε ότι η συναρτησιακή εξάρτηση είναι *άμεση* (direct).
  
## Παράδειγμα συναρτησιακών εξαρτήσεων (1)

* Έστω ότι έχουμε τη σχέση:
  ```
  Movies(title, year, length, filmType, studioName, starName)
  ```

* Η σχέση αυτή μπορεί να αντιστοιχεί στον παρακάτω πίνακα:

  | title | year | length | filmType | studioName | starName |
  |-------|------|--------|----------|------------|----------|
  | Star Wars | 1977 | 124 | color | Fox | Carrie Fisher |
  | Star Wars | 1977 | 124 | color | Fox | Mark Hamill |
  | Star Wars | 1977 | 124 | color | Fox | Harrison Ford |
  | Mighty Ducks | 1991 | 104 | color | Disney | Emilio Estevez |
  | Wayne's World | 1992 | 95 | color | Paramount | Dana Carvey |
  | Wayne's World | 1992 | 95 | color | Paramount | Mike Meyers |


## Παράδειγμα συναρτησιακών εξαρτήσεων (2)

* Έχουμε τις εξής τρεις συναρτησιακές εξαρτήσεις:
  $$\texttt{title}\ \texttt{year} \rightarrow \texttt{length}$$
  $$\texttt{title}\ \texttt{year} \rightarrow \texttt{filmType}$$ 
  $$\texttt{title}\ \texttt{year} \rightarrow \texttt{studioName}$$
  
* Μπορούμε επίσης να γράψουμε:
  $$\texttt{title}\ \texttt{year} \rightarrow \texttt{length}\ 
  \texttt{filmType}\ \texttt{studioName}$$


## Κλειδιά

* Λέμε ότι ένα σύνολο μιας ή περισσότερων ιδιοτήτων $\{A_1, A_2,
  \ldots, A_n\}$ είναι ένα *κλειδί* μιας σχέσης $R$ αν:
  
  1. Αυτές οι ιδιότητες προσδιορίζουν συναρτησιακά όλες τις άλλες
     ιδιότητες της σχέσης. Συνεπώς, αφού οι σχέσεις είναι σύνολα,
     είναι αδύνατον να υπάρχουν δύο πλειάδες με τις ίδιες $A_1, A_2,
     \ldots, A_n$.
     
  2. Κανένα γνήσιο υποσύνολο του $\{A_1, A_2, \ldots, A_n\}$ δεν
     προσδιορίζει συναρτησιακά όλες τις άλλες ιδιότητες της $R$·
     δηλαδή, ένα κλειδί πρέπει να είναι *ελάχιστο* (minimal).

* Αν ένα κλειδί αποτελείται από μία ιδιότητα, ονομάζεται *απλό*
  (simple). Αν αποτελείται από περισσότερες, ονομάζεται *σύνθετο*
  (composite key).

* Στο παράδειγμά μας, οι ιδιότητες $\{\texttt{title}, \texttt{year},
  \texttt{starName}\}$ αποτελούν κλειδί της σχέσης $\texttt{Movies}$.


## Υπερκλειδιά

* Ένα σύνολο ιδιοτήτων που περιέχει ένα κλειδί ονομάζεται *υπερκλειδί*
  (αγγλικά: superkey, από το superset of keys).
  
* Κάθε κλειδί είναι και υπερκλειδί.

* Κάθε υπερκλειδί όμως δεν είναι απαραίτητα και κλειδί.

* Στο παράδειγμά μας, το 
  $$\{\texttt{title}, \texttt{year}, \texttt{starName}\}$$ 
  είναι κλειδί και υπερκλειδί, ενώ το 
  $$\{\texttt{title}, \texttt{year}, \texttt{starName},
  \texttt{length}, \texttt{studioName}\}$$ 
  είναι υπερκλειδί.
  

# Κανονικοποίηση

## Γενικά {#normalisation-general}

* Οι σχέσεις (πίνακες) των δεδομένων μας σε μία σχεσιακή βάση πρέπει
  να ακολουθούν κάποιους κανόνες.

* Συγκεκριμένα, υπάρχει μια σειρά από *κανονικές μορφές* (normal
  forms).

* Κάθε κανονική μορφή εκφράζει κάποιους κανόνες που πρέπει να
  ακολουθούμε στο σχεδιασμό μιας σχεσιακής βάσης.

* Οι κανονικές μορφές είναι διατεταγμένες: μία κανονική μορφή
  προϋποθέτει τις προηγούμενές της.


# 1η κανονική μορφή {#first-nf}

## Ορισμός {#first-nf-def}

* Μία σχέση είναι στην 1η κανονική μορφή (First Normal Form, 1NF) αν
  και μόνο αν το πεδίο κάθε ιδιότητάς της είναι ατομικό.

* Αυτό σημαίνει ότι σε μία σχέση στην 1η κανονική μορφή, κάθε ιδιότητα
  έχει μία μόνο τιμή.


## Παράδειγμα παραβίασης 1ης κανονικής μορφής

Ο [παρακάτω
πίνακας](https://en.wikipedia.org/wiki/First_normal_form) παραβιάζει
την πρώτη κανονική μορφή:

| Customer ID | First Name | Surname | Telephone Number                     |
|-------------|------------|---------|--------------------------------------|
| 123         | Pooja      | Singh   | 555-861-2025, 192-122-1111           |
| 456         | San        | Zhang   | (555) 403-1659 Ext. 53; 182-929-2929 |
| 789         |John        | Doe     | 555-808-9633                         |


## Μη ενδεδειγμένη λύση

| Customer ID | First Name | Surname | Telephone Number1  | Telephone Number2 |
|-------------|------------|---------|--------------------|-------------------|
| 123         | Pooja      | Singh   | 555-861-2025	         | 192-122-1111   |
| 456         | San        | Zhang   |(555) 403-1659 Ext. 53 | 182-929-2929   |
| 789         | John       | Doe     | 555-808-9633	         |                |


<div class="notes">

Τι προβλήματα έχει αυτή η λύση;

* Δεν είναι προφανές γιατί ένας πελάτης πρέπει να έχει μέχρι δύο
  τηλέφωνα. Μπορεί να έχει παραπάνω.

* Αν θεωρούμε ότι το ένα τηλέφωνο είναι πιο σημαντικό από το άλλο, και
  αυτό θέλουμε να δείξουμε με τη σειρά που τα έχουμε ορίσει στις
  στήλες, παραβιάζουμε τον ορισμό μιας σχέσης: σε μία σχέση οι
  ιδιότητες που την απαρτίζουν δεν έχουν καμμία διάταξη μεταξύ τους.

</div>


## 1NF: 1η λύση {#first-nf-solution-1}

Customer

| Customer ID | First Name | Surname | Telephone Number      |
|-------------|------------|---------|-----------------------|
| 123         | Pooja      | Singh   |555-861-2025           |
| 123         | Pooja      | Singh   |192-122-1111           |
| 456         | San        | Zhang   |182-929-2929           |
| 456         | San        | Zhang   |(555) 403-1659 Ext. 53 |
| 789         | John       | Doe     |555-808-9633           |


## 1NF: 2η λύση {#first-nf-solution-2}

Customer Name

| Customer ID | First Name | Surname |
|-------------|------------|---------|
| 123         | Pooja      | Singh   |
| 456         | San        | Zhang   |
| 789         | John       | Doe     |


Customer Telephone Number

| Customer ID  | Telephone Number |
|--------------|------------------|
| 123          | 555-861-2025     |
| 123          | 192-122-1111     |
| 456          | (555) 403-1659 Ext. 53 |
| 456          | 182-929-2929 |
| 789          | 555-808-9633 |


# 2η κανονική μορφή {#second-nf}

## Ορισμός {#second-nf-def}

* Μία σχέση είναι στη 2η κανονική μορφή (2nd normal form, 2NF) αν
  είναι στην 1η κανονική μορφή και καμμία ιδιότητα που δεν είναι
  κλειδί δεν εξαρτάται συναρτησιακά από κάποιο γνήσιο υποσύνολο ενός
  κλειδιού.

* Η 2η κανονική μορφή εφαρμόζεται μόνο όταν έχουμε σύνθετα κλειδιά.

* Παραβιάζεται αν μια ιδιότητα που δεν είναι κλειδί εξαρτάται από
  υποσύνολο του κλειδιού.


## Παραβίαση 2ης κανονικής μορφής {#second-nf-violation}

Electric Toothbrush Models

| Manufacturer | Model       | Model Full Name      | Manufacturer Country |
|--------------|-------------|----------------------|----------------------|
| Forte        | X-Prime     | Forte X-Prime        | Italy                |
| Forte        | Ultraclean  | Forte Ultraclean     | Italy                |
| Dent-o-Fresh | EZbrush     | Dent-o-Fresh EZbrush | USA                  |
| Kobayashi    | ST-60       | Kobayashi ST-60      | Japan                |
| Hoch         | Toothmaster | Hoch Toothmaster     | Germany              |
| Hoch         | X-Prime     | Hoch X-Prime         | Germany              |


## Διόρθωση 2ης κανονικής μορφής {#second-nf-fix}

Electric Toothbrush Manufacturers

| Manufacturer | Manufacturer Country |
|--------------|----------------------|
| Forte        | Italy                |
| Dent-o-Fresh | USA                  |
| Kobayashi    | Japan                |
| Hoch         | Germany              |

Electric Toothbrush Models

| Manufacturer | Model       | Model Full Name      |
|--------------|-------------|----------------------|
| Forte        | X-Prime     | Forte X-Prime        |
| Forte        | Ultraclean  | Forte Ultraclean     |
| Dent-o-Fresh | EZbrush     | Dent-o-Fresh EZbrush |
| Kobayashi    | ST-60       | Kobayashi ST-60      |
| Hoch         | Toothmaster | Hoch Toothmaster     |
| Hoch         | X-Prime     | Hoch X-Prime         |


# 3η κανονική μορφή {#third-nf}

## Ορισμός {#third-nf-def}

Μία σχέση είναι στην 3η κανονική μορφή (3rd Normal Form, 3NF) όταν:

* Η σχέση βρίσκεται στη 2η κανονική μορφή.

* Κάθε ιδιότητα που δεν είναι μέρος ενός κλειδιού εξαρτάται άμεσα
  συναρτησιακά από κάθε κλειδί της σχέσης.

## 3η κανονική μορφή, εναλλακτικός ορισμός {#third-nf-alt}

Ένας εναλλακτικός ορισμός της 3ης κανονικής μορφής είναι ο εξής:

* Μία σχέση βρίσκεται στην 3η κανονική μορφή αν και μόνο αν, για κάθε
  μία από τις συναρτησιακές εξαρτήσεις $X \rightarrow Y$, ισχύει
  τουλάχιστον μία από τις παρακάτω συνθήκες:
  
  1. Το $X$ περιέχει το $Y$, δηλαδή η $X \rightarrow Y$ είναι
     τετριμμένη.
  2. Το $Χ$ είναι υπερκλειδί.
  3. Κάθε στοιχείο του $Y - X$ (της διαφοράς των συνόλων $Y$ και $X$)
     περιέχεται σε ένα κλειδί.

## Παράδειγμα παραβίασης 3ης κανονικής μορφής (1)

Tournament Winners

| Tournament           | Year | Winner         | Winner Date of Birth |
|----------------------|------|----------------|----------------------|
| Indiana Invitational | 1998 | Al Fredrickson | 21 July 1975         |
| Cleveland Open       | 1999 | Bob Albertson  | 28 September 1968    |
| Des Moines Masters   | 1999 | Al Fredrickson | 21 July 1975         |
| Indiana Invitational | 1999 | Chip Masterson | 14 March 1977        |

<div class="notes">

Γιατί παραβιάζεται η 3η κανονική μορφή;

* Η ιδιότητα Winner Date of Birth εξαρτάται από την ιδιότητα Winner. Η
  ιδιότητα Winner δεν είναι κλειδί ή μέρος κλειδιού. Το κλειδί είναι η
  πλειάδα (Tournament, Year).

</div>


## Παράδειγμα παραβίασης 3ης κανονικής μορφής (2)

| Employee | Department | Location |
|----------|------------|----------|
|  key     |   ...      |  ...     |

<div class="notes">

Η ιδιότητα Location εξαρτάται από την ιδιότητα Department, η οποία δεν
είναι κλειδί.

Τι προβλήματα προκύπτουν;

* Η διεύθυνση κάθε τμήματος επαναλαμβάνεται σε κάθε εγγραφή που
  αναφέρεται σε αυτό το τμήμα.

* Αν αλλάξει η διεύθυνση κάθε τμήματος, πρέπει να αλλάξουμε κάθε εγγραφή
  που αναφέρεται σε αυτό το τμήμα.

* Η βάση μπορεί να περιέχει ασυνέπειες, με διαφορετικές εγγραφές για
  το ίδιο τμήμα να δίνουν διαφορετικές διευθύνσεις.

* Αν ένα τμήμα δεν έχει υπαλλήλους, δεν ξέρουμε τη διεύθυνσή του.

</div>

## Διόρθωση

Employee

| Employee | Department |
|----------|------------|
| key      |    ...     |

Department

| Department | Location |
|------------|----------|
| key        |  ...     |


# Boyce-Codd Normal Form (BCNF)

## Ορισμός {#bcnf-def}

* Η κανονική μορφή Boyce-Codd είναι μια ελαφρώς ισχυρότερη κανονική
  μορφή από την 3η κανονική μορφή.
  
* Σπανίως μία σχέση που βρίσκεται στην 3η κανονική μορφή δεν θα
  βρίσκεται στην Boyce-Codd κανονική μορφή.
  
* Μία σχέση βρίσκεται στην Boyce-Codd κανονική μορφή, αν κάθε φορά που
  έχουμε μια εξάρτηση $Χ \rightarrow Y$, το $Χ$ είναι υπερκλειδί της
  σχέσης. 

## Boyce-Codd Normal Form (εναλλακτικός ορισμός)

* Μία σχέση βρίσκεται στην Boyce Codd κανονική μορφή αν και μόνο αν, για κάθε
  μία από τις συναρτησιακές εξαρτήσεις $X \rightarrow Y$, ισχύει
  τουλάχιστον μία από τις παρακάτω συνθήκες:
  
  1. Το $X$ περιέχει το $Y$, δηλαδή η $X \rightarrow Y$ είναι
     τετριμμένη.
  2. Το $Χ$ είναι υπερκλειδί.

## Παραβίαση BCND (1)

Today's Court Bookings

| Court | Start Time | End Time | Rate Type | 
|-------|------------|----------|-----------|
|     1 |      09:30 |    10:30 | SAVER     |
|     1 |      11:00 |    12:00 | SAVER     |
|     1 |      14:00 |    15:30 | STANDARD  |
|     2 |      10:00 |    11:30 | PREMIUM-B |
|     2 |      11:30 |    13:30 | PREMIUM-B |
|     2 |      15:00 |    16:30 | PREMIUM-A |

* Στη σχέση αυτή, οι χρεώσεις ισχύουν ανά γήπεδο:
  * SAVER για το γήπεδο 1, όταν πρόκειται για μέλη
  * STANDARD για το γήπεδο 1, όταν δεν πρόκειται για μέλη
  * PREMIUM-A για το γήπεδο 2, όταν πρόκειται για μέλη
  * PREMIUM-B για το γήπεδο 2, όταν δεν πρόκειται για μέλη

## Παραβίαση BCND (2)

* Τα υποψήφια κλειδιά της παραπάνω σχέσης είναι:

  * $S_1 = \{ \texttt{Court},\ \texttt{Start Time}\}$
  * $S_2 = \{ \texttt{Court},\ \texttt{End Time}\}$
  * $S_3 = \{ \texttt{Rate Type},\ \texttt{Start Time}\}$
  * $S_4 = \{ \texttt{Rate Type},\ \texttt{End Time}\}$

* Συνεπώς υπάρχει η συναρτησιακή εξάρτηση:
  $$ \texttt{Rate Type} \rightarrow \texttt{Court}$$
  όπου το $\texttt{Rate Type}$ δεν είναι υπερκλειδί.

## Διόρθωση BCNF

Rate Types

| Rate Type | Court | Member Flag |
|-----------|-------|-------------|
| SAVER     | 1     | Yes         |
| STANDARD  | 1     | No          |
| PREMIUM-A | 2     | Yes         |
| PREMIUM-B | 2     | No          |

Today's Bookings

| Member Flag | Court | Start Time | End Time | 
|-------------|-------|------------|----------|
| Yes         |     1 |      09:30 |    10:30 |
| Yes         |     1 |      11:00 |    12:00 |
| No          |     1 |      14:00 |    15:30 |
| No          |     2 |      10:00 |    11:30 |
| No          |     2 |      11:30 |    13:30 |
| Yes         |     2 |      15:00 |    16:30 |


# 4η Κανονική Μορφή {#fourth-nf}

## Προέλευση του προβλήματος

* Έστω ότι έχουμε την εξής δομή:

  <table>
  <tr>
  <th>Course</th>
  <th>Teachers</th>
  <th>Texts</th>
  </tr>
  <tr>
  <td rowspan="2">Physics</td>
  <td>Prof. Green</td>
  <td>Basic Mechanics</td>
  </tr>
  <tr>
  <td>Prof. Brown</td>
  <td>Principles of Optics</td>
  </tr>
  <tr>
  <td rowspan="3">Math</td>
  <td rowspan="3">Prof. Green</td>
  <td>Basic Mechanics</td>
  </tr>
  <tr>
  <td>Vector Analysis</td>
  </tr>
  <tr>
  <td>Trigonometry</td>
  </tr>
  </table>

* Κάθε μάθημα μπορεί να το διδάξει ένα συγκεκριμένο σύνολο καθηγητών.

* Κάθε μάθημα έχει ένα συγκεκριμένο σύνολο συγγραμμάτων.

* Δεν υπάρχει εξάρτηση μεταξύ συγγραμάτων και καθηγητών.


## Άλλο παράδειγμα

* Έστω επίσης το παρακάτω παράδειγμα:

  <table>
  <tr>
  <th>Employee</th>
  <th>Skill</th>
  <th>Language<th/>
  </tr>
  <tr>
  <td colspan="3" align="center"> ..... key ..... </td>
  </tr>
  </table>

* Κάθε υπάλληλος έχει ένα συγκεκριμένο σύνολο δεξιοτήτων.

* Κάθε υπάλληλος ξέρει ένα συγκεκριμένο σύνολο γλωσσών.

* Δεν υπάρχει εξάρτηση μεταξύ γλωσσών και δεξιοτήτων.


## Εξαρτήσεις

* Δεν ισχύει συναρτησιακή εξάρτηση $\texttt{Employee} \rightarrow
  \texttt{Skill}$.
  
* Παρ' όλα αυτά, κάθε υπάλληλος έχει ένα καλά ορισμένο σύνολο
  δεξιοτήτων.
  
* Ομοίως δεν ισχύει η συναρτησιακή εξάρτηση $\texttt{Employee}
  \rightarrow \texttt{Language}$, παρά το ότι κάθε υπάλληλος γνωρίζει
  ένα καλά ορισμένο σύνολο γλωσσών.


## Πολυσήμαντες συναρτησιακές εξαρτήσεις {#mvd-def}

* Έστω ότι έχουμε μια σχέση $R$ και $A$, $B$, $C$ είναι υποσύνολα των
  ιδιοτήτων της $R$. Τότε λέμε ότι η $B$ είναι *πολυεξαρτημένη από την
  $A$*, και συμβολίζουμε με:
  $$ A \twoheadrightarrow B$$
  αν και μόνο αν, σε κάθε δυνατή τιμή της $R$, το σύνολο των τιμών $B$
  που αντιστοιχούν στις τιμές των $(A, C)$, εξαρτώνται μόνο από τις
  τιμές του $A$ και όχι από τις τιμές του $C$.

* Μια τέτοια εξάρτηση ονομάζεται *πολυσήμαντη συναρτησιακή
  εξάρτηση* (Multivalued Functional Dependency, MVD).
  

## Ζεύγη πολυσήμαντων συναρτησιακών εξαρτήσεων

* Μπορεί να αποδειχθεί ότι οι πολυσήμαντες συναρτησιακές εξαρτήσεις
  εμφανίζονται πάντοτε σε ζεύγη.
  
* Αν έχουμε μια σχέση $R = (A, B, C)$, τότε η:
  $$A \twoheadrightarrow B$$ 
  ισχύει αν και μόνο αν ισχύει η:
  $$A \twoheadrightarrow C$$
  
* Για το λόγο αυτό, μπορούμε και γράφουμε:
  $$A \twoheadrightarrow B \vert C$$ 


## Συνδυασμοί

* Προσέξτε ότι στο πρώτο παράδειγμα, για κάθε μάθημα εμφανίζονται όλοι
  οι δυνατοί συνδυασμοί διδάσκοντα και συγγράματος.
  
* Γενικότερα, αν σε μία σχέση με $A \twoheadrightarrow B | C$ 
  εμφανίζονται τα:
  $$(a_1, b_1, c_1)\quad (a_1, b_2, c_2)$$
  τότε θα εμφανίζονται και τα:
  $$(a_1, b_1, c_2)\quad (a_1, b_2, c_1)$$

* Άρα, μία πολυσήμαντη συναρτησιακή εξάρτηση δηλώνει ότι δύο σύνολα
  ιδιοτήτων σε μία σχέση εμφανίζονται με όλους τους δυνατούς
  συνδυασμούς των τιμών τους.


## Ορισμός {#fourth-nf-def}

* Μία σχέση βρίσκεται στην 4η κανονική μορφή (Fourth Normal Form,
  4NF), αν και μόνο αν κάθε σε μία από τις μη τετριμμένες
  πολυσήμαντες συναρτησιακές εξαρτήσεις $X \twoheadrightarrow Y$,
  το $X$ είναι υπερκλειδί.

* Μια πολυσήμαντη συναρτησιακή σχέση $A \twoheadrightarrow B$ είναι
  τετριμμένη όταν είτε το $A$ είναι υπερσύνολο του $B$ ή η ένωση των
  $Α$ και $B$ μας δίνει όλες τις ιδιότητες της σχέσης.

## Προσπάθεια επίλυσης (1) {#fourth-nf-try-1}

* Μπορεί να έχουμε εγγραφές με ένα από τα δύο πεδία, αλλά όχι και τα
  δύο.
  
  | Employee | Skill | Language |
  |----------+-------+----------|
  | Smith    | cook  |          |
  | Smith    | type  |          |
  | Smith    |       | French   |
  | Smith    |       | German   |
  | Smith    |       | Greek    |

<div class="notes">

Το πρόβλημα δεν λύνεται καλά, διότι ένα κενό στη στήλη \texttt{Skill}
μπορεί να σημαίνει ότι ο υπάλληλος δεν έχει καμμία δεξιότητα, ότι η
στήλη αυτή δεν έχει εφαρμογή στον υπάλληλο, ότι είναι άγνωστο, ή ότι η
δεξιότητα μπορεί να βρεθεί σε άλλη εγγραφή.

</div>


## Προσπάθεια επίλυσης (2) {#fourth-nf-try-2}

* Τυχαία μίξη, με τις ελάχιστες δυνατές εγγραφές, χωρίς κενά.

  | Employee | Skill | Language |
  |----------+-------+----------|
  | Smith    | cook  | French   |
  | Smith    | type  | German   |
  | Smith    | type  | Greek    |


## Προσπάθεια επίλυσης (3) {#fourth-nf-try-3}

* Τυχαία μίξη, με τις ελάχιστες δυνατές εγγραφές, με κενά.

  | Employee | Skill | Language |
  |----------+-------+----------|
  | Smith    | cook  | French   |
  | Smith    | type  | German   |
  | Smith    |       | Greek    |


## Προσπάθεια επίλυσης (4) {#fourth-nf-try-4}

* Τυχαία μίξη, χωρίς περιορισμούς.

  | Employee | Skill | Language |
  |----------+-------+----------|
  | Smith    | cook  | French   |
  | Smith    | type  |          |
  | Smith    |       | German   |
  | Smith    | type  | Greek    |

## Προσπάθεια επίλυσης (5) {#fourth-nf-try-5}

* Καρτεσιανό γινόμενο.

  | Employee | Skill | Language |
  |----------+-------+----------|
  | Smith    | cook  | French   |
  | Smith    | cook  | German   |
  | Smith    | cook  | Greek    |
  | Smith    | type  | French   |
  | Smith    | type  | German   |
  | Smith    | type  | Greek    |


## Επίλυση {#fourth-nf-sol}

Employee Skills

<table>
<tr>
<th>Employee</th>
<th>Skill</th>
</tr>
<tr>
<td colspan="2" align="center">... key ... </td>
</tr>
</table>

Employee Languages

<table>
<tr>
<th>Employee</th>
<th>Language</th>
</tr>
<tr>
<td colspan="2" align="center">... key ... </td>
</tr>
</table>
